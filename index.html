<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Om Hub</title>
  <style>
    body { margin: 0; font-family: Arial, sans-serif; background: #000; color: white; height: 100vh; display: flex; flex-direction: column; }
    
    /* Home / Welcome Screen */
    #home-screen { 
      display: flex; 
      flex-direction: column; 
      justify-content: center; 
      align-items: center; 
      min-height: 100vh; 
      background: #111; 
      text-align: center; 
      padding: 20px;
    }
    #home-screen h1 { color: lime; margin-bottom: 15px; }
    #home-screen p { margin: 6px 0; }
    #home-screen button { background: #007bff; color: white; border: none; padding: 12px 20px; margin: 10px; border-radius: 6px; font-size: 16px; cursor: pointer; }
    
    /* Premium box */
    #premium-box { margin-top: 25px; border: 2px solid gold; padding: 15px; border-radius: 8px; background: #222; text-align: left; max-width: 350px; }
    #premium-box h2 { color: gold; text-align: center; }
    #premium-box ul { padding-left: 20px; }
    #premium-box button { width: 100%; margin-top: 8px; }
    
    /* Unlock Modal */
    #unlock-modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.95); justify-content: center; align-items: center; flex-direction: column; z-index: 1000; text-align: center; padding: 20px; }
    #unlock-modal h2 { color: gold; margin-bottom: 20px; }
    .code-inputs { display: flex; gap: 10px; margin-bottom: 15px; }
    .code-inputs input { width: 40px; height: 40px; font-size: 20px; text-align: center; border: 2px solid gold; border-radius: 6px; background: #000; color: white; }

    /* Main App */
    #main-app { display: none; flex: 1; flex-direction: column; height: 100%; width: 100%; }
    #header { background: #111; padding: 10px; text-align: center; border-bottom: 2px solid lime; }
    #header h2 { margin: 0; font-size: 18px; color: lime; }
    #online-count { color: gold; font-size: 14px; margin-top: 5px; }

    #video-container { flex: 1; display: flex; flex-direction: column; background: #000; position: relative; }
    video { background: #333; border: 2px solid lime; border-radius: 6px; object-fit: cover; width: 100%; height: 100%; }
    #stranger-video { flex: 1; }
    #self-video { position: absolute; top: 10px; right: 10px; width: 30%; height: 20%; }

    #bottom-section { flex: none; background: #111; border-top: 2px solid lime; padding: 10px; display: flex; flex-direction: column; height: 40%; }
    #chat-messages { flex: 1; overflow-y: auto; background: #000; padding: 10px; border-radius: 6px; margin-bottom: 10px; }
    #chat-input { display: flex; gap: 5px; margin-bottom: 10px; }
    #chat-input input { flex: 1; padding: 8px; border: none; border-radius: 6px; }
    #chat-input button { background: #007bff; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; }
    #controls { text-align: center; }
    #controls button, #controls select { background: #007bff; color: white; border: none; padding: 10px 15px; margin: 5px; border-radius: 6px; font-size: 16px; cursor: pointer; }
    #controls select { color: black; }
    .vip { color: gold; font-weight: bold; }
    .system-msg { color: lime; font-weight: bold; }

    @media screen and (orientation: landscape) {
      #main-app { flex-direction: column; }
      #video-container { flex-direction: row; width: 100%; height: 100vh; }
      #stranger-video, #self-video { position: static; flex: 1; width: 50%; height: 100vh; border-radius: 0; }
      #bottom-section { position: relative; width: 100%; height: auto; max-height: 60vh; overflow-y: auto; }
    }
  </style>
</head>
<body>

  <!-- Home Screen -->
  <div id="home-screen">
    <h1>‚ö†Ô∏è Welcome to Om Hub</h1>
    <p>You must be <b>18+</b> to enter.</p>
    <p>No nudity, hate speech, or harassment.</p>
    <p>Creator: @revising_dude_offical</p>
    <p style="color: gold; font-size: 18px; margin-top: 10px;">üåü Where Malayalis find each other ü§™ (not for marriage üòπ)</p>
    <p style="color: lime; font-size: 16px; font-style: italic;">‚ú® Chat. Connect. Laugh. A premium hangout for Malayalis worldwide üåç</p>
    <button onclick="enterApp()">I Agree & Enter</button>

    <div id="premium-box">
      <h2>üî• Upgrade to Premium</h2>
      <ul>
        <li>‚≠ê Get a VIP Badge & Title</li>
        <li>üë© 100% Girl-Only Matchmaking</li>
        <li>üé• Unlock Ultra HD (1080p) Video</li>
        <li>üíé Priority Connection Speed</li>
      </ul>
      <p><b>Price:</b> ‚Çπ199 (One-time)</p>
      <p>Pay via FamPay UPI: <b>7025571392@fam</b></p>
      <button onclick="payNow()">üí≥ Pay Now</button>
      <button onclick="notifyOwner()">I Paid ‚Äì Notify Owner</button>
      <button onclick="showUnlock()">I Have Code ‚Äì Unlock</button>
    </div>
  </div>

  <!-- Unlock Modal -->
  <div id="unlock-modal">
    <h2>Enter Your 6-Digit Unlock Code</h2>
    <div class="code-inputs">
      <input maxlength="1"><input maxlength="1"><input maxlength="1">
      <input maxlength="1"><input maxlength="1"><input maxlength="1">
    </div>
    <button onclick="checkCode()">Unlock Premium</button>
    <button onclick="closeUnlock()">Cancel</button>
  </div>

  <!-- Main App -->
  <div id="main-app">
    <div id="header">
      <h2>Om Hub Video Chat</h2>
      <div id="online-count">üåê Online: <b>0</b></div>
    </div>
    <div id="video-container">
      <video id="stranger-video" autoplay playsinline></video>
      <video id="self-video" autoplay playsinline muted></video>
    </div>

    <div id="bottom-section">
      <div id="chat-messages"><p><b class="system-msg">System:</b> Say hi to your stranger üëã</p></div>
      <div id="chat-input">
        <input type="text" id="message" placeholder="Type a message...">
        <button onclick="sendMessage()">Send</button>
      </div>
      <div id="controls">
        <button onclick="startStranger()">Start</button>
        <button style="background: green;" onclick="nextStranger()">Skip Stranger</button>
        <button onclick="flipCamera()">Flip Camera</button>
        <select id="cameraSelect" onchange="startCamera()">
          <option value="user">Camera 1 (Facing front)</option>
          <option value="environment">Camera 2 (Facing back)</option>
        </select>
        <select id="qualitySelect" onchange="startCamera()">
          <option value="320x240">Low (320x240)</option>
          <option value="640x480" selected>Medium (640x480)</option>
          <option value="1280x720">High (1280x720)</option>
          <option value="1920x1080" class="premium-only">Ultra (Premium)</option>
        </select>
      </div>
    </div>
  </div>

  <script>
    const OWNER_WHATSAPP = "917025571392";
    const selfVideo = document.getElementById('self-video');
    const strangerVideo = document.getElementById('stranger-video');
    const chatMessages = document.getElementById('chat-messages');
    const unlockModal = document.getElementById('unlock-modal');
    const codeInputs = unlockModal.querySelectorAll("input");
    const onlineCount = document.getElementById("online-count").querySelector("b");

    let localStream, peerConnection, ws;
    let isPremium = localStorage.getItem("premium") === "true";
    let currentFacingMode = "user";

    const servers = { iceServers: [{ urls: "stun:stun.l.google.com:19302" }] };

    function enterApp() {
      document.getElementById("home-screen").style.display = "none";
      document.getElementById("main-app").style.display = "flex";
      startCamera();
      connectSignaling();
    }

    function payNow() { window.open("upi://pay?pa=7025571392@fam&pn=OmHubPremium&am=199&cu=INR", "_blank"); }
    function notifyOwner() {
      const msg = encodeURIComponent("Hello, I paid ‚Çπ199, please send my Premium Code.");
      window.open(`https://wa.me/${OWNER_WHATSAPP}?text=${msg}`, "_blank");
    }
    function showUnlock() { unlockModal.style.display = "flex"; codeInputs[0].focus(); }
    function closeUnlock() { unlockModal.style.display = "none"; }
    function checkCode() {
      let code = ""; codeInputs.forEach(input => code += input.value);
      if (code.toUpperCase() === "VIP199") { localStorage.setItem("premium", "true"); isPremium = true; alert("üéâ Premium Unlocked!"); closeUnlock(); }
      else alert("‚ùå Wrong code");
    }

    function addChatMessage(user, msg) {
      const p = document.createElement("p");
      p.innerHTML = `<b class="${user.includes('VIP') ? 'vip' : user === 'System' ? 'system-msg' : ''}">${user}:</b> ${msg}`;
      chatMessages.appendChild(p); chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    async function startCamera() {
      try {
        localStream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: currentFacingMode }, audio: true
        });
        selfVideo.srcObject = localStream;
      } catch (err) { alert("Camera error: " + err); }
    }

    function flipCamera() {
      currentFacingMode = currentFacingMode === "user" ? "environment" : "user";
      startCamera();
    }

    // === WebRTC Signaling ===
    function connectSignaling() {
      ws = new WebSocket("wss://your-signaling-server.com"); // Replace with your server
      ws.onmessage = async (event) => {
        const data = JSON.parse(event.data);

        if (data.online) {
          onlineCount.textContent = data.online;
        }

        if (data.offer) {
          peerConnection = createPeer();
          await peerConnection.setRemoteDescription(new RTCSessionDescription(data.offer));
          const answer = await peerConnection.createAnswer();
          await peerConnection.setLocalDescription(answer);
          ws.send(JSON.stringify({ answer }));
        } else if (data.answer) {
          await peerConnection.setRemoteDescription(new RTCSessionDescription(data.answer));
        } else if (data.ice) {
          try { await peerConnection.addIceCandidate(new RTCIceCandidate(data.ice)); } catch (e) {}
        }
      };
    }

    function createPeer() {
      const pc = new RTCPeerConnection(servers);
      localStream.getTracks().forEach(track => pc.addTrack(track, localStream));
      pc.ontrack = (event) => { strangerVideo.srcObject = event.streams[0]; };
      pc.onicecandidate = (event) => {
        if (event.candidate) ws.send(JSON.stringify({ ice: event.candidate }));
      };
      return pc;
    }

    async function startStranger() {
      peerConnection = createPeer();
      const offer = await peerConnection.createOffer();
      await peerConnection.setLocalDescription(offer);
      ws.send(JSON.stringify({ offer }));
      addChatMessage("System", "üîó Searching for a stranger...");
    }

    function nextStranger() {
      addChatMessage("System", "‚è≠Ô∏è Skipped, finding new stranger...");
      strangerVideo.srcObject = null;
      if (peerConnection) peerConnection.close();
      startStranger();
    }

    function sendMessage() {
      const input = document.getElementById("message");
      if (input.value.trim() !== "") {
        addChatMessage(isPremium ? "VIP (You)" : "You", input.value);
        // TODO: send over data channel
        input.value = "";
      }
    }
  </script>
</body>
</html>